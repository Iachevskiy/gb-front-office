FROM node:latest AS builder
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package.json –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY package.json package-lock.json ./
RUN npm install --frozen-lockfile

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ Vue –∏ –±–∏–ª–¥–∏–º –ø—Ä–æ–µ–∫—Ç
COPY . .

# –ü–µ—Ä–µ–¥–∞—ë–º ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø—Ä–∏ –±–∏–ª–¥–µ
ARG VITE_API_URL
ENV VITE_API_URL=$VITE_API_URL

RUN npm run build

# üîπ 2. –≠—Ç–∞–ø —Å Nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ –≥–æ—Ç–æ–≤–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–∞
FROM nginx:latest
COPY /deploy/nginx.conf /etc/nginx/nginx.conf

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã Vue –∏–∑ `dist/` –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É Nginx
COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 80
